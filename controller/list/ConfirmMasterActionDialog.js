/*
 * Copyright (C) 2009-2020 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/Global","sap/ui/model/json/JSONModel","fin/ap/approvebankpayments/model/formatter"],function(B,U,J,f){"use strict";var c="fin.ap.approvebankpayments.view.list.ConfirmActionDialog";var _=f;function a(m,r,g){var A={"app":["masterSelectedBatchesApprove","Success"],"def":["masterSelectedBatchesDefer","Warning"],"rej":["masterSelectedBatchesReject","Error"],"ret":["masterSelectedBatchesReturn","Warning"]};var h=A[m.action];var t=g.length;var i=g.filter(function(j){return j.getProperty("IsActiveEntity")&&j.getProperty("HasDraftEntity");}).map(function(j){return j.getProperty("DraftAdministrativeData/InProcessByUser");});var l=i.filter(function(u){return u;}).length;m.actionTitle=r.getText(h[0]);m.actionStatus=h[1];m.title=r.getText("userConfirmDialogBatchTitle",[m.actionTitle]);m.hasLocked=l>0;m.lockMessage=r.getText("confirmDialogLockMessage",[l,t]);m.unsavedCount=i.length-l;m.hasUnsaved=m.unsavedCount>0;m.unsavedMessage=r.getText("confirmDialogUnsavedMessage",[m.unsavedCount,t]);m.freeCount=t-i.length;m.readyCount=m.freeCount;m.takeOver=false;return new J(m);}function b(m){var g=m.getProperty("/readyCount")>0&&(!m.getProperty("/isReject")||!!m.getProperty("/note"));if(m.getProperty("/enabled")!==g){m.setProperty("/enabled",g);}}function d(m){var i=m.getProperty("/takeOver");var r=m.getProperty("/freeCount")+(i?m.getProperty("/unsavedCount"):0);m.setProperty("/readyCount",r);b(m);}var e={"/takeOver":d,"/note":b};return B.extend("fin.ap.approvebankpayments.controller.list.ConfirmMasterActionDialog",{_resolve:null,_reject:null,constructor:function(v,m,g){this._viewModel=a(m,v.getModel("@i18n").getResourceBundle(),g);b(this._viewModel);this._viewModel.attachPropertyChange(null,this._viewModelPropertyChanged,this);this._oDialog=U.xmlfragment(v.createId("ConfirmMasterActionDialog"),c,this);v.addDependent(this._oDialog);this._oDialog.setModel(this._viewModel,"action");return new Promise(function(r,R){this._resolve=r;this._reject=R;this._oDialog.open();}.bind(this));},numberOfBatches:function(n){return _.numberOfBatches(n);},onConfirmMasterDialogOkPress:function(){var m=this._oDialog.getModel("action");var g={action:m.getProperty("/action"),note:m.getProperty("/note"),isDefer:m.getProperty("/isDefer"),deferDate:_.dateTimeToDate(m.getProperty("/deferDate")),takeOver:m.getProperty("/takeOver")};this._oDialog.close();this._resolve(g);},onConfirmMasterDialogCancelPress:function(){this._oDialog.close();this._reject();},onAfterConfirmMasterClose:function(){this._viewModel.detachPropertyChange(this._viewModelPropertyChanged,this);this._oDialog.destroy();},_viewModelPropertyChanged:function(E){var p=E.getParameters();if(p&&p.reason==="binding"&&e[p.path]){e[p.path](this._viewModel);}}});});
